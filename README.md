# Bigrid Provider Service

Latest Version: `v1.4.0`


> âœ… For Users: See [Docker](#docker-container) for how to install and run the application as a container.
>
> ðŸ§‘â€ðŸ’» For Developers: See [How to Build and Start the Service](#how-to-build-and-start-the-service) if you want to build and run the service locally.
> 
> Usage: See [RESTful Web Endpoints](#RESTful-Web-Endpoints) on how to use the service.

## Introduction

**BiGrid Provider Service** is a reactive Spring Boot REST API for generating rich, **bigraph-style spatial location models** â€” including grids, quadtrees, convex shapes, and interpolated lines.

Models are delivered in multiple formats:
- **XML** â€“ fully Ecore-compliant bigraph instance or meta-models
- **JSON** â€“ lightweight, custom serialization
- **Base64-encoded Protobuf** â€“ compact binary for efficient transmission

These location models are ideal for **cyber-physical systems**, simulation workflows, and **formal consistency checks** in reactive bigraph programs, enabling precise spatial reasoning and adaptive behaviors.

### Features

#### Location Models

The service can generate and return parameterizable bigraph-style location models in XML, JSON, or Base64-encoded Protobuf formats.

Currently supported model types:

- Points â€“ Randomly placed within a given boundary.
- Uniform nÃ—m Grids â€“ Evenly spaced points with configurable origin and step sizes.
- Quadtrees â€“ Recursive spatial subdivision with a defined boundary.
- Lines (Interpolated) â€“ Points generated along interpolated paths with custom step sizes.
- Convex Shapes â€“ Models generated from a convex polygon defined by an ordered point set.
- Meta-model Retrieval â€“ Obtain or create the core bigraph meta-model for schema/consistency validation.
- CDO Repository Fetch â€“ Retrieve existing models directly from a remote CDO server.

#### Ecore-Compliant Models

All XML outputs follow the Ecore standard from the Eclipse Modeling Framework (EMF), ensuring interoperability with model-driven engineering tools.
Every bigraphical location model generated by this service strictly conforms to the [Bigraph Ecore Metamodel (BEM)](https://github.com/bigraph-toolkit-suite/bigraphs.bigraph-ecore-metamodel), enabling seamless integration, validation, and transformation within EMF-based workflows.

## RESTful Web Endpoints

### Retrieve the Bi-Spatial Metamodel

You can retrieve the Ecore-based metamodel used for all bi-spatial location models. 
This metamodel defines the structure and types of the instance models (e.g., grids, interpolated trajectories) that your application will load or validate.

```shell
$ curl http://localhost:8080/generate/metamodel?format=xml
```

This metamodel is required to:
- Validate location-based bigraph instance models.
- Enable model-driven tools (e.g., EMF, Eclipse) to work with generated content.
- Maintain consistency across different cyber-physical space representations.

### Create Random Points

Within a default 2D rectangle (boundary) from (0,0) to (10,10):

```shell
$ curl "http://localhost:8080/generate/points/random?pointCount=10" \
-H "Content-Type: application/json"
```

Within a given rectangular boundary:

```shell
$ curl -X POST "http://localhost:8080/generate/points/random?pointCount=15" \
-H "Content-Type: application/json" \
-d '{
    "x": 0.0,
    "y": 0.0,
    "width": 15.0,
    "height": 15.0
}'
```

Arguments:
`?pointCount=<INT>`: maximum number of points to generate


### Create a Quadtree

You have to supply points of the form as shown in the example.
The output format can be specified via the format argument.

```shell
$ curl -X POST "http://localhost:8080/generate/quadtree?maxTreeDepth=4&format=xml" \
-H "Content-Type: application/json" \
-d '{
    "boundary": {
        "x": 0.0,
        "y": 0.0,
        "width": 10.0,
        "height": 10.0
    },
    "pointData": {
          "points": [
            {"x": 0.2, "y": 0.2},
            {"x": 1.0, "y": 2.0},
            {"x": 3.0, "y": 4.0}
          ]
    }
}'

# Protobuf Output Format
$ curl -X POST "http://localhost:8080/generate/quadtree?maxTreeDepth=4&format=protobuf" \
-H "Content-Type: application/json" \
-d '{
    "boundary": {
        "x": 0.0,
        "y": 0.0,
        "width": 10.0,
        "height": 10.0
    },
    "pointData": {
          "points": [
            {"x": 0.2, "y": 0.2},
            {"x": 1.0, "y": 2.0},
            {"x": 3.0, "y": 4.0}
          ]
    }
}'
```

**Arguments:**

- Format: `?format=xml` (Default), `?format=json`, `?format=protobuf`
- Configurable max points before subdivision: `?maxTreeDepth=<INT>`
- Configurable max depth of the quadtree: `?maxPointsPerLeaf=<INT>`

**Example:**

```shell
$ curl http://localhost:8080/generate/quadtree?format=json&maxTreeDepth=4&maxPointsPerLeaf=1
```

### Interpolate Points

```shell
$ curl -X POST http://localhost:8080/generate/interpolated?format=xml \
  -H "Content-Type: application/json" \
  -d '{
    "points": [
        {"x": 0, "y": 0},
        {"x": 1, "y": 1},
        {"x": 2, "y": 2}
    ],
    "stepSizeX": 0.25,
    "stepSizeY": 0.25
  }'
  
# Protobuf Messages format
$ curl -X POST http://localhost:8080/generate/interpolated?format=protobuf \
  -H "Content-Type: application/json" \
  -d '{
    "points": [
        {"x": 0, "y": 0},
        {"x": 1, "y": 1},
        {"x": 2, "y": 2}
    ],
    "stepSizeX": 0.25,
    "stepSizeY": 0.25
  }'
```

**Arguments:**

- Format: `?format=xml` (Default), `?format=json`, `?format=protobuf`

### Generate a Bi-Spatial Convex Shape

This endpoint creates a bi-spatial bigraph model based on a custom list of 2D points that define a convex polygon. 
The interior of the shape is rasterized using a specified step size, and a spatial location node is generated for each rasterized point.

This generates a convex bi-spatial structure from a list of polygon vertices:
```shell
$ curl -X POST http://localhost:8080/generate/convex \
  -H "Content-Type: application/json" \
  -d '{
        "stepSize": 0.25,
        "points": [
          { "x": 0.0, "y": 0.0 },
          { "x": -1.24, "y": 0.58 },
          { "x": 2.86, "y": 2.93 },
          { "x": 3.08, "y": 0.0 }
        ]
      }'
      
# Protobuf Messages format
$ curl -X POST http://localhost:8080/generate/convex?format=protobuf \
  -H "Content-Type: application/json" \
  -d '{
        "stepSize": 0.25,
        "points": [
          { "x": 0.0, "y": 0.0 },
          { "x": -1.24, "y": 0.58 },
          { "x": 2.86, "y": 2.93 },
          { "x": 3.08, "y": 0.0 }
        ]
      }'
```


**Arguments:**

- Format: `?format=xml` (Default), `?format=json`, `?format=protobuf`
- Step Size (required): included in body â†’ `"stepSize": 0.25`



**Use Cases:**

- Defining irregular regions of interest in a spatial simulation.
- Modeling bounded areas in drone or robot navigation maps.
- Loading custom-shaped digital twin spaces into your application.

### Generate a Uniform Bi-Spatial Grid

These endpoints allow you to generate a **uniform grid-based bi-spatial bigraph model**, which serves as a spatial structure of discrete locations. The grid can be used as a base layout for simulation, visualization, or as part of a digital twin model.

Example: Generate a **default 3x3 grid** with step size 1.0 in both directions, where the origin is at (x,y) = (0,0):

```shell
$ curl http://localhost:8080/generate/bigrid
$ curl "http://localhost:8080/generate/bigrid?rows=4&cols=2&format=xml"
$ curl "http://localhost:8080/generate/bigrid?rows=2&cols=2&format=protobuf"
```

To adjust the default values:

```shell
# Default Parameters (3x3)
$ curl -X POST http://localhost:8080/generate/bigrid \
  -H "Content-Type: application/json" \
  -d '{"x":0,"y":0,"stepSizeX":1.5,"stepSizeY":2.0}'

# With Parameters
$ curl -X POST "http://localhost:8080/generate/bigrid?rows=6&cols=6" \
  -H "Content-Type: application/json" \
  -d '{"x":0,"y":0,"stepSizeX":0.5,"stepSizeY":0.5}'
```

**Arguments:**

- Format: `?format=xml` (Default), `?format=json`, `?format=protobuf`
- Rows (default: `3`): `?rows=3`
- Columns (default: `3`): `?cols=3`

### Fetch a CDO Model

You can fetch an existing **CDO-based bigraph model** directly from a remote repository.
This is useful when working with shared models stored in a collaborative EMF/CDO setup.

```shell
$ curl "http://localhost:8080/fetch/cdo?address=cdo.server:2036&repopath=/my/model/path&format=xml"
$ curl "http://localhost:8080/fetch/cdo?address=cdo.server:2036&repopath=/system&resFactor=1.0&format=protobuf"
```

**Arguments:**

- Address: `?address=127.0.0.1:2036` â€” CDO server host and port
- RepoPath: `?repopath=/system` â€” Path to the resource in the CDO repository
- Format: `?format=xml` (Default), `?format=json`, `?format=protobuf`

## How to Build and Start the Service

**1. Building:**
```
$ ./mvnw clean package -DskipTests
```

**2. Running:**
```shell
$ java -jar ./bin/bigrid-provider-service.jar
```
### Configuration

| Parameter | Default | Command-Line         | System Property      | Environment Variable      |
|-----------|---------|----------------------|----------------------|---------------------------|
| Port      | 8080    | `--server.port=9090` | `-Dserver.port=9090` | `export SERVER_PORT=9090` |


**Example:**

```shell
# Command-Line
$ java -jar bigrid-provider-service.jar --server.port=9090

# System Property
$ java -Dserver.port=9090 -jar bigrid-provider-service.jar

# Environment Variable
$ export SERVER_PORT=9090 && java -jar bigrid-provider-service.jar
```

**Order of Priority**

Spring Boot evaluates properties in this order:
- Command-line arguments (the highest priority)
- Environment variables
- `application.properties`
- Default configuration (the lowest priority)

## Docker Container

**1. Build the image:**

```shell
$ docker build -t bigrid-provider-service .
```

**2. Run the container:**

```shell
$ docker run -p 8080:8080 bigrid-provider-service
```

**Change the port (optional):**
```shell
docker run -p 9090:9090 \
  -e "SPRING_APPLICATION_JSON={\"server.port\":9090}" \
  bigrid-provider-service
```

## Contributing

Contributions are welcomed from the open source community! 
To get started:

- See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines on how to propose changes or submit pull requests.

- Please review our [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md) to foster an inclusive and respectful environment.


## License

This project is licensed under the Apache License 2.0.

You are free to use, modify, and distribute this software in accordance with the license terms.